<html>

<head>

  <title>Tomato Logger</title>
  <link rel="stylesheet" href="bower_components/bootstrap/dist/css/bootstrap.min.css" />
  <script src="bower_components/jquery/dist/jquery.min.js"></script>
  <script src="bower_components/qwest/src/qwest.js"></script>
  <script src="bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
  <script src="bower_components/ajax-form.js/index.js"></script>
  <script src="bower_components/handlebars/handlebars.min.js"></script>

</head>

<body>

  <div class="container-fluid">

    <p>Hello,</p>
      
    <p>Welcome to tomato logger</p>

    <hr />

    <form class="form ajax-form" onsubmit="return false;">

      <div class="form-group">
        <input class="form-control" name="title" placeholder="title" />
      </div>

      <div class="form-group">
        <input class="form-control" name="mood" placeholder="mood" />
      </div>

      <div class="form-group">
        <textarea class="form-control" name="notes" placeholder="notes"></textarea>
      </div>

      <div class="form-group">
        <input class="form-control" name="performance" placeholder="performance" />
      </div>

      <div class="form-group">
        <button
          class="form-control"
          data-api="/api/tomato"
          data-method="put">Tomato Log</button>
      </div>

    </form>

    <hr />

    <div class="ajax-view" data-api="/api/tomato" data-template="#tmpl-tomato" data-response-type="json"></div>
    
  </div>

<script type="text/x-handlebars" id="tmpl-tomato">
  <div>
  <p>total: {{count}}</p>
  {{#each items}}
  <hr />
  <p>title: {{title}}</p>
  <p>notes: <pre>{{notes}}</pre></p>
  <p>started at: {{startedAt}}</p>
  {{/each}}
  </div>
</script>
    
<script>

var initAjaxView = function () {

    $('.ajax-view').each(function () {

        var $div = $(this);

        var api = $div.attr('data-api');
        var method = $div.attr('data-method') || 'get';
        var template = $div.attr('data-template');
        var responseType = $div.attr('data-response-type') || 'auto';

        template = $(template).text().trim();

        var tmpl = Handlebars.compile(template);

        if (!api) {

            throw new Error('api is not specified: ' + api);

        }

        qwest[method](api, null, {responseType: responseType}).then(function (resp) {

            var html = tmpl(resp);

            $div.html(html);

        });

    });

};

$(function () {

    $('form.ajax-form').on('success.ajax-form', function () {

        location.reload();

    });

    initAjaxView();

});

</script>

</body>
</html>
